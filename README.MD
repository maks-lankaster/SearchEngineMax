# **SearchEngineMax**

## **Описание**

Поисковый движок, представляющий собой консольное приложение
(исполняемый файл, запускаемый на любом сервере или компьютере),
осуществляющее поиск и имеющее возможность настройки через файлы формата
JSON

## **Принципы работы**

1. В конфигурационном файле перед запуском приложения задаются названия
   файлов, по которым движок будет осуществлять поиск.

2. Поисковый движок самостоятельно обходит все файлы и
   индексирует их так, чтобы потом по любому поисковому запросу находить наиболее
   релевантные документы.

3. Пользователь задаёт запрос через JSON-файл requests.json. Запрос — это
   набор слов, по которым нужно найти документы.

4. Запрос трансформируется в список слов.

5. В индексе ищутся те документы, в которых встречаются все эти слова.

6. Результаты поиска ранжируются, сортируются и отдаются пользователю.
   Максимальное количество возможных документов в ответе задаётся в
   конфигурационном файле.

7. В конце программа формирует файл answers.json, в который записывает
   результаты поиска.

## **Требования**

Для корректной работы программы необходимо следующиее:

### 1. Наличие в директории с проектом конфигурационного файла config.json
config.json должен содержать:

- название поискового движка,
- его версию,
- максимальное количество вариантов в ответе (если не указано, то значение
  выбирается равным пяти),
- список файлов, по которым будет производиться поиск

*Пример описания файла config.json:*

```
{
    "config": {
        "name": "SearchEngineMax",
        "version": "1.0",
        "max_responses": 5
    },
    "files": [
        "../resources/file001.txt",
        "../resources/file002.txt",
        "../resources/file003.txt",
        "../resources/file004.txt",
        …
    ]
}
```
Файл config.json включен в проект в качестве примера.

### 2. Наличие в директории с проектом файла с поисковыми запросами requests.json

requests.json должен содержать:
- запросы, которые необходимо обработать поисковому движку
  - не более 1000 запросов, в каждом от 1 до 10 слов
  - запрос состоит из слов, разделенных одним или несколькими пробелами
  - все слова состоят из строчных латинских букв

*Пример описания файла requests.json:*

```
{
    "requests": [
        "some words..",
        "some words..",
        "some words..",
        "some words..",
        …
    ]
}
```

Файл requests.json включен в проект в качестве примера.

### 3. По результату работы программа создает файл с ответами answers.json

answers.json содержит:

- answers — базовое поле, которое содержит ответы на запросы,
- request001 … 003 — идентификатор запроса, по которому сформирован ответ (формируется автоматически по порядку, в котором
  находятся запросы в поле requests файла requests.json),
- result – результат поиска запроса. Если он принимает значение true, значит по
  данному запросу найден хотя бы один документ. Если результат имеет значение
  false, значит ни одного документа не найдено. Тогда других полей в ответе на
  этот запрос нет,
- relevance включается в файл answers.json, если на этот запрос удалось найти
  более одного документа,
- далее идут соответствия рейтинга ответа и названия id документа, в котором
    осуществлялся поиск,
- ранг ответа (“rank”) — ранг или поисковый рейтинг. Это число показывает,
  насколько документ подходит для заданного запроса. В ответе id документов
  располагаются в порядке уменьшения поискового рейтинга.

*Пример описания файла answers.json:*

```
{
    "answers": {
        "request001": {
            "result": "true",
            "relevance": [
                { "docid": 0, “rank” : 0.989 },
                { "docid": 1, “rank” : 0.897 },
                { "docid": 2, “rank” : 0.750 },
                { "docid": 3, “rank” : 0.670 },
                { "docid": 4, “rank” : 0.561 }
            ]
        },
        "request002": {
            "result": "true",
            "docid": 0, “rank” : 0.769
        },
        "request003": {
            "result": "false"
        }
    }
}
```

## **Классы и методы**

### - Kласс ConverterJSON
Работа со всеми JSON-файлами, описанными выше

### ***Методы класса:***

```
std::vector<std::string> getTextDocuments();

Получение содержимого файлов, перечисленных в config.json
```

```
int getResponsesLimit();

Метод считывает поле maxResponses для определения предельного количества ответов на один запрос
```

```
std::vector<std::string> getRequests();

Получение списка запросов из файла requests.json
```

```
void putAnswers(std::vector<std::vector<std::pair<int, float>>> answers);

Положить в файл answers.json результаты поисковых запросов
```

### - Kласс InvertedIndex

Инвертированная индексация документов

### ***Методы класса:***

```
void updateDocumentBase(std::vector<std::string> inputDocs);

Обновить или заполнить базу документов, по которой будет совершен
поиск. Параметр inputDocs - содержимое документов
```

```
std::vector<Entry> getWordCount(const std::string& word);

Метод определяет количество вхождений слова *word* в загруженной базе
документов. Возвращает подготовленный список объектов структуры *Entry*, где
docId - идентификатор документа, count - количество вхождений слова в документе
```

```
struct Entry {
    std::size_t docId, count;
    bool operator ==(const Entry& other) const {
        return (docId == other.docId &&
                count == other.count);
    }
};
```

### - Kласс SearchServer

Обработка поискового запроса

### ***Методы класса:***

```
SearchServer(InvertedIndex& idx) : iIndex(idx){ };

В конструктор класса передаётся ссылка на класс
InvertedIndex, чтобы SearchServer мог узнать частоту слов встречаемых в запросе
```

```
std::vector<std::vector<RelativeIndex>> search(const std::vector<std::string>& requests);

Метод обработки поисковых запросов *requests* из файла requests.json.
Возвращает отсортированный список релевантных ответов для заданных запросов
(структура RelativeIndex, где docId - идентификатор документа, rank - релевантность)
```

```
struct RelativeIndex{
    std::size_t docId;
    float rank;
    bool operator ==(const RelativeIndex& other) const {
        return (docId == other.docId && rank == other.rank);
    }
};
```
   
## **Работа с проектом**

1. В файле ***main.cpp*** присутствуют две закомментированные функции ***writeConfigFile()*** и ***writeRequestsFile()*** - эти функции создают конфигурационный файл и задают поисковый запрос соответственно (раскомментируйте эти функции, чтобы создать указанные файлы).
2. В проекте присутствует директория ***resources***, содержащая несколько текстовых файлов, по которым в качестве примера можно произвести поиск (именно эта директория указана в файле *config.json*)
3. Исполняемый файл поискового движка - ***SearchEngineMax.exe***

## **Тесты**

К проету подключена система тестирования ***Google Test***.

Исполняемый файл для проведения тестов - ***RunTests.exe***
